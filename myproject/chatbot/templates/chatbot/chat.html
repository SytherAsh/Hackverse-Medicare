{% extends 'chatbot/base.html' %}

{% block title %}Chat with PDF{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">Chat with Your PDF</h1>

    <div id="chatMessages" class="bg-white rounded-lg shadow-md p-4 mb-4 h-[500px] overflow-y-auto space-y-4">
        <div class="text-center text-gray-500">Start asking questions about your PDF!</div>
    </div>

    <form id="questionForm" class="flex gap-2">
        <input type="text" id="question" class="flex-1 border rounded-lg px-4 py-2" placeholder="Ask a question...">
        <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
            Ask
        </button>
    </form>
</div>

<script>
document.getElementById('questionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const question = document.getElementById('question').value;
    const chatMessages = document.getElementById('chatMessages');

    // Add user question
    chatMessages.innerHTML += `
        <div class="flex justify-end">
            <div class="bg-blue-100 rounded-lg p-3 max-w-[80%]">
                <p>${question}</p>
            </div>
        </div>
    `;

    try {
        const response = await axios.post('/api/ask/', {
            question: question,
            pdf_name: '{{ pdf_name }}'
        });

        // Add AI response
        chatMessages.innerHTML += `
            <div class="flex justify-start">
                <div class="bg-gray-100 rounded-lg p-3 max-w-[80%]">
                    <p>${response.data.answer}</p>
                </div>
            </div>
        `;
    } catch (error) {
        alert('Error: ' + error.response?.data?.error || error.message);
    }

    document.getElementById('question').value = '';
    chatMessages.scrollTop = chatMessages.scrollHeight;
});
</script>
{% endblock %}